# Счётчик просмотров для блог-постов

## Обзор функциональности

Система счётчика просмотров автоматически отслеживает количество просмотров каждого блог-поста и отображает эту информацию в пользовательском интерфейсе.

## Архитектура решения

### 1. База данных
- **Поле**: `views_count` (unsigned integer, по умолчанию 0)
- **Таблица**: `blog_posts`
- **Индексы**: Включено в составные индексы для производительности

### 2. Модель BlogPost
```php
// app/Models/BlogPost.php
public function incrementViews(): void
{
    $this->increment('views_count');
}
```

### 3. Сервисный слой
```php
// app/Services/BlogPostService.php
public function incrementViews(BlogPost $post): void
{
    if ($post->isPublished()) {
        $post->incrementViews();
    }
}
```

### 4. Контроллер
```php
// app/Http/Controllers/BlogPostController.php
public function show(BlogPost $post)
{
    // ... другой код ...
    
    // Увеличиваем счётчик только для опубликованных постов
    $this->blogPostService->incrementViews($post);
    
    // ... остальной код ...
}
```

## Пользовательский интерфейс

### 1. Список постов (Index.vue)
- Отображение количества просмотров в карточке каждого поста
- Иконка `Eye` из Lucide для визуального обозначения

### 2. Страница поста (Show.vue)
- Показ актуального количества просмотров
- Автоматическое увеличение при каждом посещении

### 3. Карточка поста (BlogPostCard.vue)
```vue
<span class="flex items-center gap-1">
    <Eye class="h-3 w-3" />
    {{ post.views_count }}
</span>
```

## Бизнес-логика

### Правила инкремента
1. **Только опубликованные посты**: Драфты и архивные посты не увеличивают счётчик
2. **Каждый просмотр**: Каждое посещение страницы поста увеличивает счётчик на 1
3. **Без дедупликации**: Повторные просмотры от одного пользователя учитываются

### Производительность
- Использование `increment()` для атомарной операции в БД
- Минимальное количество SQL-запросов
- Кэширование не требуется для простых счётчиков

## Тестирование

### Покрытые сценарии
1. ✅ Увеличение счётчика для опубликованных постов
2. ✅ Сохранение счётчика для драфтов (не увеличивается)
3. ✅ Множественные просмотры
4. ✅ Отображение в списке постов
5. ✅ Отображение на странице поста

### Запуск тестов
```bash
php artisan test --filter=ViewsCounterTest
```

## Возможные улучшения

### Краткосрочные
- Добавление анимации при обновлении счётчика
- Группировка просмотров по IP/сессии
- Исключение просмотров автора своих постов

### Долгосрочные
- Аналитика просмотров по времени
- Трендинг алгоритм на основе просмотров
- Redis для высоконагруженных приложений
- События и слушатели для расширения функциональности

## Конфигурация

Система работает из коробки без дополнительной настройки. Поле `views_count` автоматически включается в:
- Fillable массив модели
- Cast к integer
- JSON ответы API
- Vue компоненты

## Совместимость

- ✅ Laravel 12
- ✅ Vue 3 + TypeScript
- ✅ Inertia.js
- ✅ Lucide иконки
- ✅ Reka UI компоненты
# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –±–ª–æ–≥-–ø–æ—Å—Ç–∞–º

## –ü—Ä–æ–±–ª–µ–º–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚ùå **–ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞:**
   ```php
   // –í Service
   protected function isUserAdmin(): bool {
       return DB::table('user_roles')->join('roles'...)...
   }
   
   // –í Controller  
   $isAdmin = $user && DB::table('user_roles')->join('roles'...)...
   ```

2. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ `isAdmin()`:**
   - –í –º–æ–¥–µ–ª–∏ `User` —É–∂–µ –±—ã–ª –º–µ—Ç–æ–¥ `isAdmin()` 
   - –ü–∏—Å–∞–ª–∏ —Å–ª–æ–∂–Ω—ã–µ DB –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è

3. **–°–º–µ—à–∞–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –≤ Service:**
   ```php
   // Service –∑–∞–Ω–∏–º–∞–ª—Å—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
   if ($isAdmin && $request->has('status')) {
       $query->where('status', $request->status);
   } elseif (!$isAdmin) {
       $query->published();
   }
   ```

## –†–µ—à–µ–Ω–∏–µ: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

### ‚úÖ **–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥:**

#### 1. **Request –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é**
```php
// BlogPostIndexRequest::authorize()
public function authorize(): bool
{
    if ($this->has('status')) {
        /** @var \App\Models\User|null $user */
        $user = Auth::user();
        
        // –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ 'published', —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–¥–º–∏–Ω
        if ($this->status !== BlogPost::STATUS_PUBLISHED && (!$user || !$user->isAdmin())) {
            return false;
        }
    }
    return true;
}
```

#### 2. **Service –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π**
```php
// BlogPostService::applyStatusFilter()
protected function applyStatusFilter(Builder $query, BlogPostIndexRequest $request): void
{
    /** @var \App\Models\User|null $user */
    $user = Auth::user();
    $isAdmin = $user && $user->isAdmin(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π –º–µ—Ç–æ–¥!
    
    if ($request->has('status') && in_array($request->status, BlogPost::STATUSES)) {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —É–∂–µ –ø—Ä–æ—à–ª–∞ –≤ Request
        $query->where('status', $request->status);
    } elseif (!$isAdmin) {
        // –ù–µ-–∞–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ
        $query->published();
    }
    // –ê–¥–º–∏–Ω—ã –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞ –≤–∏–¥—è—Ç –í–°–ï –ø–æ—Å—Ç—ã
}
```

#### 3. **Controller –ø–µ—Ä–µ–¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ UI —Ñ–ª–∞–≥–∏**
```php
// BlogPostController::index()
return Inertia::render('Blog/Posts/Index', [
    'canFilterByStatus' => $user?->isAdmin() ?? false, // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...
]);
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### üöÄ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

1. **Single Responsibility Principle:**
   - Request ‚Üí –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - Service ‚Üí –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ 
   - Controller ‚Üí –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è

2. **DRY (Don't Repeat Yourself):**
   - –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π `User::isAdmin()`
   - –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è DB –∑–∞–ø—Ä–æ—Å–æ–≤

3. **Security by Design:**
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤—Ö–æ–¥–∞ (Request authorization)
   - Impossible States Made Impossible

### ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

| –ü–æ–¥—Ö–æ–¥ | –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|--------|--------------|-----------|
| **–°—Ç–∞—Ä—ã–π** | `DB::table('user_roles')->join()` –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ | O(n) |
| **–ù–æ–≤—ã–π** | `$user->isAdmin()` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è) | O(1) |

### üß™ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:**

```php
// –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ
$request = new BlogPostIndexRequest();
$request->merge(['status' => 'draft']);
$this->assertFalse($request->authorize());

// –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –æ—Ç–¥–µ–ª—å–Ω–æ  
$posts = $service->getFilteredPosts($validRequest);
```

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### üìã **–ú–∞—Ç—Ä–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–∞:**

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –ü–∞—Ä–∞–º–µ—Ç—Ä `?status=` | Request Auth | Service Filter | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|-------------|-------------------|-------------|----------------|-----------|
| **Guest** | `published` | ‚úÖ Pass | Published only | –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ |
| **Guest** | `draft` | ‚ùå **403** | - | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω |
| **User** | `published` | ‚úÖ Pass | Published only | –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ |  
| **User** | `draft` | ‚ùå **403** | - | –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω |
| **Admin** | `published` | ‚úÖ Pass | Status filter | –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ |
| **Admin** | `draft` | ‚úÖ Pass | Status filter | –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ |
| **Admin** | –Ω–µ —É–∫–∞–∑–∞–Ω | ‚úÖ Pass | No filter | **–í–°–ï –ø–æ—Å—Ç—ã** |

### üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

1. **–ó–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ HTTP:** 
   - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã = 403 Forbidden
   - –ù–µ –¥–æ—Ö–æ–¥—è—Ç –¥–æ Service/Database

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   ```php
   // –í rules() –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç
   'status' => ['nullable', 'string', 'in:published,draft,archived']
   
   // –í authorize() –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞  
   if ($this->status !== 'published' && !$user?->isAdmin()) return false;
   ```

3. **Defense in Depth:**
   - –î–∞–∂–µ –µ—Å–ª–∏ Request –ø—Ä–æ–ø—É—Å—Ç–∏—Ç - Service –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞—â–∏—â—ë–Ω

## –ú–∏–≥—Ä–∞—Ü–∏—è –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- **101 —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç** (–∏–∑ 101 –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- Frontend –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ

### üîÑ **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**

#### –£–¥–∞–ª–µ–Ω–æ:
- –°–ª–æ–∂–Ω—ã–µ DB –∑–∞–ø—Ä–æ—Å—ã –≤ Service –∏ Controller  
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞
- –ò–º–ø–æ—Ä—Ç—ã `DB`, `Role` –≥–¥–µ –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã

#### –î–æ–±–∞–≤–ª–µ–Ω–æ:
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ `BlogPostIndexRequest`
- 8 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Request –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ `User::isAdmin()`

#### –ò–∑–º–µ–Ω–µ–Ω–æ:
- –£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `BlogPostService::applyStatusFilter()`
- –£–ø—Ä–æ—â—ë–Ω `BlogPostController::index()`

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é

### üéØ **–î–ª—è –¥—Ä—É–≥–∏—Ö —á–∞—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã:**
1. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö DB –∑–∞–ø—Ä–æ—Å–æ–≤
2. –†–∞–∑–¥–µ–ª—è–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (Request) –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (Service)  
3. –ü–æ–∫—Ä—ã–≤–∞–π—Ç–µ —Ç–µ—Å—Ç–∞–º–∏ –∫–∞–∂–¥—ã–π —Å–ª–æ–π –æ—Ç–¥–µ–ª—å–Ω–æ

### üîÆ **–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π:** `$user->roles` –≤ Redis –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
2. **Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** –ü–µ—Ä–µ–Ω–æ—Å –ª–æ–≥–∏–∫–∏ –∏–∑ Request –≤ middleware
3. **Policy –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –°–≤—è–∑–∞—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ `BlogPostPolicy`
4. **Audit logging:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ restricted –∫–æ–Ω—Ç–µ–Ω—Ç—É

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ **—á–∏—â–µ, –±—ã—Å—Ç—Ä–µ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ**:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è Laravel
- ‚úÖ –°–ª–µ–¥—É–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º SOLID  
- ‚úÖ –£–ª—É—á—à–∞–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü–æ–≤—ã—à–∞–µ–º —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –£–ø—Ä–æ—â–∞–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É

–≠—Ç–æ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç—å **—Ä–µ–≤–∏–∑–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π** –∏ **–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞** –≤–º–µ—Å—Ç–æ –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏—è –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤.